# Messengor
> Мессенджер на Go.

Messengor - это клиент-серверное консольное приложение для обмена мгновенными сообщениями, разработанное на языке программирования Go. Проект реализован в рамках курсовой работы по дисциплине "Операционные сети".

## Особенности

*   **Клиент-серверная архитектура:** Взаимодействие осуществляется через центральный сервер.
*   **WebSocket протокол:** Для обмена сообщениями в реальном времени используется WebSocket.
*   **JSON формат данных:** Сообщения между клиентом и сервером структурированы в формате JSON.
*   **Аутентификация пользователей:** Поддержка регистрации и входа пользователей. Учетные данные хранятся на сервере.
*   **Типы чатов:**
    *   **Глобальный (широковещательный) чат:** Сообщения видны всем подключенным пользователям.
    *   **Личные чаты:** Возможность приватного общения между двумя пользователями.
*   **История сообщений:** Сохранение истории как для глобального, так и для личных чатов на стороне сервера (в файлах JSONL).
*   **Консольный клиент:** Простое и понятное консольное приложение для взаимодействия с мессенджером.
*   **Конкурентный сервер:** Сервер написан с использованием горутин для эффективной обработки множества одновременных клиентских подключений.

## Технологический стек

*   **Язык программирования:** Go (Golang)
*   **Сетевой протокол:** WebSocket
*   **Формат данных:** JSON
*   **Основная библиотека WebSocket (Go):** `github.com/gorilla/websocket`
*   **Хранение данных пользователей на сервере:** JSON-файл
*   **Хранение истории чатов на сервере:** JSONL-файлы (JSON Lines)

## Структура проекта

```
messengor/
├── cmd/
│ ├── client/
│ │ └── main.go # Исходный код клиента
│ └── server/
│ │ └── main.go # Исходный код сервера
├── internal/
│ ├── protocol/
│ │ └── messages.go # Определения структур сообщений протокола
│ └── server/
│ │ ├── auth_store.go # Логика аутентификации и хранения пользователей
│ | ├── client.go # Серверное представление клиента, read/write pumps
│ | ├── history_store_jsonl.go # Логика хранения и загрузки истории чатов
│ | ├── hub.go # Центральный хаб для управления клиентами
│ | ├── server.go # Обработчик WebSocket соединений, логика аутентификации
│ | └── utils.go # Вспомогательные функции (например, генерация ID чата)
├── chat_history/ # (если есть) Директория для файлов истории чатов (создается сервером)
├── users_data.json # (если есть) Файл с данными пользователей (создается сервером)
└── README.md
```

## Сборка и запуск

### Требования

*   Установленный Go (версия 1.18 или выше рекомендуется)

### Запуск Сервера

1.  Перейдите в директорию проекта:
    ```bash
    cd /path/to/messengor
    ```
2.  Запустите сервер:
    ```bash
    go run cmd/server/main.go
    ```
    По умолчанию сервер запустится на `localhost:8088`. Этот адрес и порт можно изменить в `cmd/server/main.go`.
    При первом запуске, если файл `users_data.json` отсутствует, он будет создан. Директория `chat_history` также будет создана при сохранении первого сообщения.

### Запуск Клиента

1.  Откройте новый терминал.
2.  Перейдите в директорию проекта:
    ```bash
    cd /path/to/messengor
    ```
3.  Запустите клиент:
    ```bash
    go run cmd/client/main.go
    ```
    Клиент по умолчанию попытается подключиться к `localhost:8088`.
    Для подключения к другому адресу сервера, используйте флаг `-addr`:
    ```bash
    go run cmd/client/main.go -addr <ip_адрес_сервера>:<порт>
    ```

### Команды клиента

После запуска клиента и успешного подключения/аутентификации доступны следующие команды:

*   `/register <username> <password> <display_name>` - Регистрация нового пользователя.
*   `/login <username> <password>` - Вход в систему.
*   `(текст сообщения)` - Отправить сообщение в текущий активный чат (по умолчанию глобальный).
*   `/pm <user_id_or_name> <сообщение>` - Отправить личное сообщение пользователю.
*   `/users` - Показать список пользователей онлайн.
*   `/history [chat_id|user_name]` - Показать историю для текущего или указанного чата (по умолчанию последние 20 сообщений).
*   `/chat <user_id_or_name>` - Переключиться в приватный чат с указанным пользователем.
*   `/chatid <full_chat_id>` - Переключиться на чат по его полному ID (например, `global_broadcast` или `private:uuid1:uuid2`).
*   `/global` - Переключиться в глобальный чат.
*   `/help` - Показать справку по командам.
*   `/exit` - Выйти из клиента.

## Автор

*   **Владимир Руппель (Vladimir Ruppel)** - ([@vladimirruppel](https://github.com/vladimirruppel))